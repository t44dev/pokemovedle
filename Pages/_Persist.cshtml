@using PokeMovedle.Models.Moves
@using PokeMovedle.Pages
@model _PersistModel 
@{
    int listCount = Model.guessedMoves.Count<Move>();
    int currentDay = MoveContext.GetDay();
}

@if (Model.reset) {
<script>
    localStorage.setItem("day", @currentDay);
    localStorage.removeItem("moves");
    console.log("Reset local storage");
</script>
}
<div class="container text-center m-3">
    <div class="row align-items-start">
        <div class="col-3"></div>
        <div class="col-6">
            <h1>PokeMovedle</h1>

            <form 
                class="input-group m-3"
                autocomplete="off"
                id="guess-form"
                hx-post="@Url.Page("Index", "Guess")"
            >
                @await Html.PartialAsync("_Submit", new _GameModel(null, listCount))
            </form>

            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Type</th>
                  <th scope="col">Power</th>
                  <th scope="col">pp</th>
                  <th scope="col">Accuracy</th>
                  <th scope="col">Class</th>
                </tr>
              </thead>
              <tbody 
                  id="answers-body"
                  hx-trigger="submit from:#guess-form"
                  hx-get="@Url.Page("Index", "Row")"
                  hx-target="this"
                  hx-swap="afterbegin"
                  hx-include="[id='guess-form']"
                  hx-on::config-request="window.lastGuessName = event.detail.parameters.guess"
                  hx-on::after-request="if (event.detail.successful) persistGuess(window.lastGuessName)"
              </tbody>
                @for (int i = 0; i < listCount; i++) {
                    @Html.Partial("_Row", new _GameModel(Model.guessedMoves[i], i))
                }
            </table>

            <div 
                id="answer-modal-container"
                hx-trigger="submit from:#guess-form"
                hx-get="@Url.Page("Index", "Modal")"
                hx-target="this"
                hx-include="[id='guess-form']"
            >
            </div>
        </div>
        <div class="col-3">
            <div id="legend">
        </div>
    </div>
</div>
  </div>
